<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Cardboard Example</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <style>
      body {
        margin: 0px;
        overflow: hidden;
      }
      #example {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
      }
            #info {
				position: absolute;
				top: 50px;
				width: 100%;
				text-align: center;
				z-index: 100;
				display:block;
			}
    </style>
  </head>
  <body>
     
    <div id="example"></div> <div id="info"><font color="red">

          Loading data in: <span id="timer"></span></font>
    </div>
    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <script type="text/javascript" src="//jquery-csv.googlecode.com/git/src/jquery.csv.js"></script>
    <script src="js/third-party/threejs/three.min.js"></script>
    <script src="js/third-party/threejs/StereoEffect.js"></script>
    <script src="js/third-party/threejs/DeviceOrientationControls.js"></script>
    <script src="js/brainvis.js"></script>
    <script src="js/dat.gui.min.js"></script>
    <script src="js/third-party/threejs/OrbitControls.js"></script>
    <script src="https://cdn.firebase.com/js/client/2.3.1/firebase.js"></script>
    <script src="js/useful.js"></script>


  <script>
    var camera, scene, renderer;
    var effect, controls;
    var element, container;
    var text = new VariableParametersBrainVisualisation();
    var clock = new THREE.Clock();
    var knownBrainEdges = new Array();
    var allLines = [];
    var totalClusters = 0;         
    var mesh;
    var locationMiddleX = 0;
    var locationMiddleY = 0;
    var locationMiddleZ = 65;

    var nodes = new Array();

    var collectionBrainCoordinates = new THREE.Geometry();
    var initialisedNodes = false;
    var initialisedEdges = false;
    var allLines = [];
    var particleSystem;
    var completeBrainParticleSystem;
    init();
    animate();


       function generateControllerUpperRight()
        {
            gui = new dat.GUI();
            var f2 = gui.addFolder('Min and max clusters');
            var minController = f2.add(text, 'minimumCluster', 0, totalClusters).step(1).listen();
            var maxController = f2.add(text, 'maximumCluster', 0, totalClusters).step(1).listen();
            var isBrainOn = f2.add(text,"displayCompleteBrain");
            f2.open();

            isBrainOn.onChange(function(value)
            {
                completeBrainParticleSystem.visible = text.displayCompleteBrain;
                
            });
            maxController.onChange(function(value) {
                if (text.minimumCluster > value) {
                    text.minimumCluster = value;
                }
            });

            minController.onChange(function(value) {
                if (text.maximumCluster < value) {
                    text.maximumCluster = value;
                }
            });
            text.maximumCluster = totalClusters;
        }
    function init() {
      renderer = new THREE.WebGLRenderer();
      element = renderer.domElement;
      container = document.getElementById('example');
      container.appendChild(element);


      scene = new THREE.Scene();

       camera = new THREE.PerspectiveCamera( 60, window.innerWidth / window.innerHeight, 1, 1000 );
      camera.position.set(0, 10, 0);
      scene.add(camera);

      controls = new THREE.OrbitControls(camera, element);
     // controls.rotateUp(Math.PI / 4);
      controls.target.set(
        locationMiddleX,
        locationMiddleY,
        locationMiddleZ
      );
      //controls.noZoom = false;
      //controls.noPan = true;
/*
      function setOrientationControls(e) {
        if (!e.alpha) {
          return;
        }

        controls = new THREE.DeviceOrientationControls(camera, true);
        controls.connect();
        controls.update();

        element.addEventListener('click', fullscreen, false);

        window.removeEventListener('deviceorientation', setOrientationControls, true);
      }
      window.addEventListener('deviceorientation', setOrientationControls, true);*/


      var light = new THREE.HemisphereLight(0x777777, 0x000000, 0.5);
      scene.add(light);

      var texture = THREE.ImageUtils.loadTexture(
        'textures/patterns/checker.png'
      );
      texture.wrapS = THREE.RepeatWrapping;
      texture.wrapT = THREE.RepeatWrapping;
      texture.repeat = new THREE.Vector2(50, 50);
      texture.anisotropy = renderer.getMaxAnisotropy();

      var material = new THREE.MeshPhongMaterial({
        color: 0xffffff,
        specular: 0xffffff,
        shininess: 20,
        shading: THREE.FlatShading,
        map: texture
      });

      var geometry = new THREE.PlaneGeometry(1000, 1000);

      var mesh = new THREE.Mesh(geometry, material);
      mesh.rotation.x = -Math.PI / 2;
      mesh.position.y = -80;
      scene.add(mesh);

        
        

      window.addEventListener('resize', resize, false);
      setTimeout(resize, 1);
    }
      
       var count=500;
      var counter=setInterval(timer, 1); 

      


    function timer()
    {
      count=count-10;
      if (count <= 0)
      {
         clearInterval(counter);
         //counter ended, do something here
          document.getElementById("info").innerHTML="";
          startLoadingDataUsingFirebase();
        //  startLoadingData();
         return;
      }

      //Do code for showing the number of seconds here
         document.getElementById("timer").innerHTML=count + " miliseconds"; 
    }
      
      
      
      
        function addAllNodes()
        {
          //  return;
            if (!(initialisedEdges && initialisedNodes)) {
                return;
            }
            console.log("Now adding all nodes");
            
        // Start adding all nodes
         var geometryPerCluster = [];
            var groupColors = [];
            var particles = new THREE.Geometry();
            var pMaterial = new THREE.ParticleSystemMaterial({
                size: 0.5,
                color: 0xffffff
            });
         // Initialise the clusters
            for (var i = 0; i < totalClusters + 1; i++) {
                geometryPerCluster[i] = new THREE.Geometry();
                groupColors[i] = []
            }
         // Process all particles in the brainvis library
            processParticles(geometryPerCluster, groupColors, particles);


            // Add all particles
            var geometry = new THREE.Geometry();
            completeBrainParticleSystem = new THREE.ParticleSystem(particles, pMaterial);
            scene.add(particleSystem, groupColors);

            allLines = initialiseAllLines(totalClusters, groupColors, geometryPerCluster);

            for (var i = 0; i < totalClusters; i++) {

                scene.add(allLines[i]);
            }
            

            // Initialise the brain particles
            var geometryPerCluster = [];
            var groupColors = [];

            var pMaterial = new THREE.ParticleSystemMaterial({
                size: 0.5,
                color: 0xffffff
            });
            
            // Initialise the clusters
            for (var i = 0; i < totalClusters + 1; i++) {
                geometryPerCluster[i] = new THREE.Geometry();
                groupColors[i] = []
            }
            for (var row = 0; row < nodes.length; row++) {
                particle = new THREE.Vector3(nodes[row][0], nodes[row][1], nodes[row][2]);
                collectionBrainCoordinates.vertices.push(particle);
            }
            // Add all particles
            var geometry = new THREE.Geometry();
            completeBrainParticleSystem = new THREE.ParticleSystem(collectionBrainCoordinates, pMaterial);
            scene.add(completeBrainParticleSystem, groupColors);
         
            // Add the changable parameters					
            generateControllerUpperRight();
        }


    function resize() {
      var width = container.offsetWidth;
      var height = container.offsetHeight;

      camera.aspect = width / height;
      camera.updateProjectionMatrix();

      renderer.setSize(width, height);
     
    }

    function update(dt) {
      resize();

      camera.updateProjectionMatrix();

      controls.update(dt);
    }

    function render(dt) {
        for (var i = 0; i < totalClusters; i++) {
                if (i >= text.minimumCluster && i <= text.maximumCluster) {
                    allLines[i].visible = true;
                } else {
                    allLines[i].visible = false;
                }
            }
      renderer.render(scene, camera);
    }

    function animate(t) {
      requestAnimationFrame(animate);

      update(clock.getDelta());
      render(clock.getDelta());
    }

    function fullscreen() {
      if (container.requestFullscreen) {
        container.requestFullscreen();
      } else if (container.msRequestFullscreen) {
        container.msRequestFullscreen();
      } else if (container.mozRequestFullScreen) {
        container.mozRequestFullScreen();
      } else if (container.webkitRequestFullscreen) {
        container.webkitRequestFullscreen();
      }
        
    }
  </script>
  </body>
</html>
